<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Translate a .osm.pbf file into .gpkg format — oe_vectortranslate • osmextract</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Translate a .osm.pbf file into .gpkg format — oe_vectortranslate"><meta property="og:description" content="This function is used to translate a .osm.pbf file into .gpkg format.
The conversion is performed using
ogr2ogr via the
vectortranslate utility in sf::gdal_utils() . It was created following
the suggestions
of the maintainers of GDAL. See Details and Examples to understand the basic
usage, and check the introductory vignette for more complex use-cases."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">osmextract</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/osmextract.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/providers_comparisons.html">Comparing the supported OSM providers</a>
    </li>
    <li>
      <a href="../articles/providers.html">Add new OpenStreetMap providers</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ropensci/osmextract/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Translate a .osm.pbf file into .gpkg format</h1>
    <small class="dont-index">Source: <a href="https://github.com/ropensci/osmextract/blob/master/R/vectortranslate.R" class="external-link"><code>R/vectortranslate.R</code></a></small>
    <div class="hidden name"><code>oe_vectortranslate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function is used to translate a <code>.osm.pbf</code> file into <code>.gpkg</code> format.
The conversion is performed using
<a href="https://gdal.org/en/stable/programs/ogr2ogr.html" class="external-link">ogr2ogr</a> via the
<code>vectortranslate</code> utility in <code><a href="https://r-spatial.github.io/sf/reference/gdal_utils.html" class="external-link">sf::gdal_utils()</a></code> . It was created following
<a href="https://github.com/OSGeo/gdal/issues/2100#issuecomment-565707053" class="external-link">the suggestions</a>
of the maintainers of GDAL. See Details and Examples to understand the basic
usage, and check the introductory vignette for more complex use-cases.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">oe_vectortranslate</span><span class="op">(</span></span>
<span>  <span class="va">file_path</span>,</span>
<span>  layer <span class="op">=</span> <span class="st">"lines"</span>,</span>
<span>  vectortranslate_options <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  osmconf_ini <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extra_tags <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force_vectortranslate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  never_skip_vectortranslate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  boundary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  boundary_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spat"</span>, <span class="st">"clipsrc"</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-file-path">file_path<a class="anchor" aria-label="anchor" href="#arg-file-path"></a></dt>
<dd><p>Character string representing the path of the input
<code>.pbf</code> or <code>.osm.pbf</code> file.</p></dd>


<dt id="arg-layer">layer<a class="anchor" aria-label="anchor" href="#arg-layer"></a></dt>
<dd><p>Which <code>layer</code> should be read in? Typically <code>points</code>, <code>lines</code>
(the default), <code>multilinestrings</code>, <code>multipolygons</code> or <code>other_relations</code>. If
you specify an ad-hoc query using the argument <code>query</code> (see introductory
vignette and examples), then <code><a href="oe_get.html">oe_get()</a></code> and <code><a href="oe_read.html">oe_read()</a></code> will read the layer
specified in the query and ignore <code>layer</code> argument. See also
<a href="https://github.com/ropensci/osmextract/issues/122" class="external-link">#122</a>.</p></dd>


<dt id="arg-vectortranslate-options">vectortranslate_options<a class="anchor" aria-label="anchor" href="#arg-vectortranslate-options"></a></dt>
<dd><p>Options passed to the <code><a href="https://r-spatial.github.io/sf/reference/gdal_utils.html" class="external-link">sf::gdal_utils()</a></code>
argument <code>options</code>. Set by default. Check details in the introductory
vignette and the help page of <code>oe_vectortranslate()</code>.</p></dd>


<dt id="arg-osmconf-ini">osmconf_ini<a class="anchor" aria-label="anchor" href="#arg-osmconf-ini"></a></dt>
<dd><p>The configuration file. See documentation at
<a href="https://gdal.org/en/stable/drivers/vector/osm.html" class="external-link">gdal.org</a>. Check details in the
introductory vignette and the help page of <code>oe_vectortranslate()</code>. Set by
default.</p></dd>


<dt id="arg-extra-tags">extra_tags<a class="anchor" aria-label="anchor" href="#arg-extra-tags"></a></dt>
<dd><p>Which additional columns, corresponding to OSM tags, should
be in the resulting dataset? <code>NULL</code> by default. Check the introductory
vignette and the help pages of <code>oe_vectortranslate()</code> and <code><a href="oe_get_keys.html">oe_get_keys()</a></code>.
Ignored when <code>osmconf_ini</code> is not <code>NULL</code>.</p></dd>


<dt id="arg-force-vectortranslate">force_vectortranslate<a class="anchor" aria-label="anchor" href="#arg-force-vectortranslate"></a></dt>
<dd><p>Boolean. Force the original <code>.pbf</code> file to be
translated into a <code>.gpkg</code> file, even if a <code>.gpkg</code> with the same name
already exists? <code>FALSE</code> by default. If tags in <code>extra_tags</code> match data in
previously translated <code>.gpkg</code> files no translation occurs (see
<a href="https://github.com/ropensci/osmextract/issues/173" class="external-link">#173</a> for details).
Check the introductory vignette and the help page of
<code>oe_vectortranslate()</code>.</p></dd>


<dt id="arg-never-skip-vectortranslate">never_skip_vectortranslate<a class="anchor" aria-label="anchor" href="#arg-never-skip-vectortranslate"></a></dt>
<dd><p>Boolean. This is used in case the user
passed its own <code>.ini</code> file or vectortranslate options (since, in those
case, it's too difficult to determine if an existing <code>.gpkg</code> file was
generated following the same options.)</p></dd>


<dt id="arg-boundary">boundary<a class="anchor" aria-label="anchor" href="#arg-boundary"></a></dt>
<dd><p>An <code>sf</code>/<code>sfc</code>/<code>bbox</code> object that will be used to create a
spatial filter during the vectortranslate operations. The type of filter
can be chosen using the argument <code>boundary_type</code>.</p></dd>


<dt id="arg-boundary-type">boundary_type<a class="anchor" aria-label="anchor" href="#arg-boundary-type"></a></dt>
<dd><p>A character vector of length 1 specifying the type of
spatial filter. The <code>spat</code> filter selects only those features that
intersect a given area, while <code>clipsrc</code> also clips the geometries. Check
the examples and also <a href="https://gdal.org/en/stable/programs/ogr2ogr.html" class="external-link">here</a> for
more details.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Boolean. If <code>FALSE</code>, the function prints informative messages.
Starting from <code>sf</code> version
<a href="https://r-spatial.github.io/sf/news/index.html#version-0-9-6-2020-09-13" class="external-link">0.9.6</a>,
if <code>quiet</code> is equal to <code>FALSE</code>, then vectortranslate operations will
display a progress bar.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Character string representing the path of the <code>.gpkg</code> file.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The new <code>.gpkg</code> file is created in the same directory as the input
<code>.osm.pbf</code> file. The translation process is performed using the
<code>vectortranslate</code> utility in <code><a href="https://r-spatial.github.io/sf/reference/gdal_utils.html" class="external-link">sf::gdal_utils()</a></code>. This operation can be
customized in several ways modifying the parameters <code>layer</code>, <code>extra_tags</code>,
<code>osmconf_ini</code>, <code>vectortranslate_options</code>, <code>boundary</code> and <code>boundary_type</code>.</p>
<p>The <code>.osm.pbf</code> files processed by GDAL are usually categorized into 5
layers, named <code>points</code>, <code>lines</code>, <code>multilinestrings</code>, <code>multipolygons</code> and
<code>other_relations</code>. Check the first paragraphs
<a href="https://gdal.org/en/stable/drivers/vector/osm.html" class="external-link">here</a> for more details. This
function can covert only one layer at a time, and the parameter <code>layer</code> is
used to specify which layer of the <code>.osm.pbf</code> file should be converted.
Several layers with different names can be stored in the same <code>.gpkg</code> file.
By default, the function will convert the <code>lines</code> layer (which is the most
common one according to our experience).</p>
<p>The arguments <code>osmconf_ini</code> and <code>extra_tags</code> are used to modify how GDAL
reads and processes a <code>.osm.pbf</code> file. More precisely, several operations
that GDAL performs on the input <code>.osm.pbf</code> file are governed by a <code>CONFIG</code>
file, that can be checked at the following
<a href="https://github.com/OSGeo/gdal/blob/master/ogr/ogrsf_frmts/osm/data/osmconf.ini" class="external-link">link</a>.
The basic components of OSM data are called
<a href="https://wiki.openstreetmap.org/wiki/Elements" class="external-link"><em>elements</em></a> and they are
divided into <em>nodes</em>, <em>ways</em> or <em>relations</em>, so, for example, the code at
line 7 of that file is used to determine which <em>ways</em> are assumed to be
polygons (according to the simple-feature definition of polygon) if they
are closed. Moreover, OSM data is usually described using several
<a href="https://wiki.openstreetmap.org/wiki/Tags" class="external-link"><em>tags</em></a>, i.e pairs of two items:
a key and a value. The code at lines 33, 53, 85, 103, and 121 is used to
determine, for each layer, which tags should be explicitly reported as
fields (while all the other tags are stored in the <code>other_tags</code> column).
The parameter <code>extra_tags</code> is used to determine which extra tags (i.e.
key/value pairs) should be added to the <code>.gpkg</code> file (other than the
default ones).</p>
<p>By default, the vectortranslate operations are skipped if the function
detects a file having the same path as the input file, <code>.gpkg</code> extension, a
layer with the same name as the parameter <code>layer</code> and all <code>extra_tags</code>. In
that case the function will simply return the path of the <code>.gpkg</code> file.
This behaviour can be overwritten setting <code>force_vectortranslate = TRUE</code>.
The vectortranslate operations are never skipped if <code>osmconf_ini</code>,
<code>vectortranslate_options</code>, <code>boundary</code> or <code>boundary_type</code> arguments are not
<code>NULL</code>.</p>
<p>The parameter <code>osmconf_ini</code> is used to pass your own <code>CONFIG</code> file in case
you need more control over the GDAL operations. Check the package
introductory vignette for an example. If <code>osmconf_ini</code> is equal to <code>NULL</code>
(the default value), then the function uses the standard <code>osmconf.ini</code> file
defined by GDAL (but for the extra tags).</p>
<p>The parameter <code>vectortranslate_options</code> is used to control the options that
are passed to <code>ogr2ogr</code> via <code><a href="https://r-spatial.github.io/sf/reference/gdal_utils.html" class="external-link">sf::gdal_utils()</a></code> when converting between
<code>.osm.pbf</code> and <code>.gpkg</code> formats. <code>ogr2ogr</code> can perform various operations
during the conversion process, such as spatial filters or SQL queries.
These operations can be tuned using the <code>vectortranslate_options</code> argument.
If <code>NULL</code> (the default value), then <code>vectortranslate_options</code> is set equal
to</p>
<p><code>c("-f", "GPKG", "-overwrite", "-oo", paste0("CONFIG_FILE=", osmconf_ini), "-lco", "GEOMETRY_NAME=geometry", layer)</code>.</p>
<p>Explanation:</p><ul><li><p><code>"-f", "GPKG"</code> says that the output format is <code>GPKG</code>;</p></li>
<li><p><code>"-overwrite</code> is used to delete an existing layer and recreate
it empty;</p></li>
<li><p><code>"-oo", paste0("CONFIG_FILE=", osmconf_ini)</code> is used to set the
<a href="https://gdal.org/en/stable/drivers/vector/osm.html#open-options" class="external-link">Open Options</a>
for the <code>.osm.pbf</code> file and change the <code>CONFIG</code> file (in case the user
asks for any extra tag or a totally different CONFIG file);</p></li>
<li><p><code>"-lco", "GEOMETRY_NAME=geometry"</code> is used to change the
<a href="https://gdal.org/en/stable/drivers/vector/gpkg.html#layer-creation-options" class="external-link">layer creation options</a>
for the <code>.gpkg</code> file and modify the name of the geometry column;</p></li>
<li><p><code>layer</code> indicates which layer should be converted.</p></li>
</ul><p>If <code>vectortranslate_options</code> is not <code>NULL</code>, then the options <code>c("-f", "GPKG", "-overwrite", "-oo", "CONFIG_FILE=", path-to-config-file, "-lco", "GEOMETRY_NAME=geometry", layer)</code> are always appended unless the user
explicitly sets different default parameters for the arguments <code>-f</code>, <code>-oo</code>,
<code>-lco</code>, and <code>layer</code>.</p>
<p>The arguments <code>boundary</code> and <code>boundary_type</code> can be used to set up a
spatial filter during the vectortranslate operations (and speed up the
process) using an <code>sf</code> or <code>sfc</code> object (<code>POLYGON</code> or <code>MULTIPOLYGON</code>). The
default arguments create a rectangular spatial filter which selects all
features that intersect the area. Setting <code>boundary_type = "clipsrc"</code> clips
the geometries. In both cases, the appropriate options are automatically
added to the <code>vectortranslate_options</code> (unless a user explicitly sets
different default options). Check Examples in <code><a href="oe_get.html">oe_get()</a></code> and the
introductory vignette.</p>
<p>See also the help page of <code><a href="https://r-spatial.github.io/sf/reference/gdal_utils.html" class="external-link">sf::gdal_utils()</a></code> and
<a href="https://gdal.org/en/stable/programs/ogr2ogr.html" class="external-link">ogr2ogr</a> for more examples and
extensive documentation on all available options that can be tuned during
the vectortranslate process.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="oe_get_keys.html">oe_get_keys()</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># First we need to match an input zone with a .osm.pbf file</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">its_match</span> <span class="op">=</span> <span class="fu"><a href="oe_match.html">oe_match</a></span><span class="op">(</span><span class="st">"ITS Leeds"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The input place was matched with: ITS Leeds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $url</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "https://github.com/ropensci/osmextract/raw/master/inst/its-example.osm.pbf"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $file_size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 40792</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Copy ITS file to tempdir so that the examples do not require internet</span></span></span>
<span class="r-in"><span><span class="co"># connection. You can skip the next 3 lines (and start directly with</span></span></span>
<span class="r-in"><span><span class="co"># oe_download()) when running the examples locally.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"its-example.osm.pbf"</span>, package <span class="op">=</span> <span class="st">"osmextract"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"test_its-example.osm.pbf"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The we can download the .osm.pbf file (if it was not already downloaded)</span></span></span>
<span class="r-in"><span><span class="va">its_pbf</span> <span class="op">=</span> <span class="fu"><a href="oe_download.html">oe_download</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  file_url <span class="op">=</span> <span class="va">its_match</span><span class="op">$</span><span class="va">url</span>,</span></span>
<span class="r-in"><span>  file_size <span class="op">=</span> <span class="va">its_match</span><span class="op">$</span><span class="va">file_size</span>,</span></span>
<span class="r-in"><span>  download_directory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  provider <span class="op">=</span> <span class="st">"test"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The chosen file was already detected in the download directory. Skip downloading.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check that the file was downloaded</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"pbf|gpkg"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "test_its-example.osm.pbf"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Convert to gpkg format</span></span></span>
<span class="r-in"><span><span class="va">its_gpkg</span> <span class="op">=</span> <span class="fu">oe_vectortranslate</span><span class="op">(</span><span class="va">its_pbf</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting with the vectortranslate operations on the input file!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0...10...20...30...40...50...60...70...80...90...100 - done.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished the vectortranslate operations on the input file!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now there is an extra .gpkg file</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"pbf|gpkg"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "test_its-example.gpkg"    "test_its-example.osm.pbf"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the layers of the .gpkg file</span></span></span>
<span class="r-in"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="va">its_gpkg</span>, do_count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Driver: GPKG </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Available layers:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   layer_name geometry_type features fields crs_name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      lines   Line String      189     10   WGS 84</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add points layer</span></span></span>
<span class="r-in"><span><span class="va">its_gpkg</span> <span class="op">=</span> <span class="fu">oe_vectortranslate</span><span class="op">(</span><span class="va">its_pbf</span>, layer <span class="op">=</span> <span class="st">"points"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding a new layer to the .gpkg file.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting with the vectortranslate operations on the input file!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0...10...20...30...40...50...60...70...80...90...100 - done.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished the vectortranslate operations on the input file!</span>
<span class="r-in"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="va">its_gpkg</span>, do_count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Driver: GPKG </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Available layers:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   layer_name geometry_type features fields crs_name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      lines   Line String      189     10   WGS 84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     points         Point      186     10   WGS 84</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add extra tags to the lines layer</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">its_gpkg</span>, layer <span class="op">=</span> <span class="st">"lines"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "osm_id"     "name"       "highway"    "waterway"   "aerialway" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] "barrier"    "man_made"   "railway"    "z_order"    "other_tags"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "geometry"  </span>
<span class="r-in"><span><span class="va">its_gpkg</span> <span class="op">=</span> <span class="fu">oe_vectortranslate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">its_pbf</span>,</span></span>
<span class="r-in"><span>  extra_tags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"oneway"</span>, <span class="st">"maxspeed"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting with the vectortranslate operations on the input file!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0...10...20...30...40...50...60...70...80...90...100 - done.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished the vectortranslate operations on the input file!</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">its_gpkg</span>, layer <span class="op">=</span> <span class="st">"lines"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "osm_id"     "name"       "highway"    "waterway"   "aerialway" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] "barrier"    "man_made"   "railway"    "oneway"     "maxspeed"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "z_order"    "other_tags" "geometry"  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Adjust vectortranslate options and convert only 10 features</span></span></span>
<span class="r-in"><span><span class="co"># for the lines layer</span></span></span>
<span class="r-in"><span><span class="fu">oe_vectortranslate</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">its_pbf</span>,</span></span>
<span class="r-in"><span>  vectortranslate_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-limit"</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Starting with the vectortranslate operations on the input file!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0...10...20...30...40...50...60...70...80...90...100 - done.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished the vectortranslate operations on the input file!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/Rtmpab3J1D/test_its-example.gpkg"</span>
<span class="r-in"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="va">its_gpkg</span>, do_count <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Driver: GPKG </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Available layers:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   layer_name geometry_type features fields crs_name</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     points         Point      186     10   WGS 84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      lines   Line String       10     10   WGS 84</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remove .pbf and .gpkg files in tempdir</span></span></span>
<span class="r-in"><span><span class="fu"><a href="oe_clean.html">oe_clean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

