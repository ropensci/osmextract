<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add new OpenStreetMap providers • osmextract</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Add new OpenStreetMap providers">
<meta property="og:description" content="osmextract">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">osmextract</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/osmextract.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/providers.html">Add new OpenStreetMap providers</a>
    </li>
    <li>
      <a href="../articles/providers_comparisons.html">Comparing the supported OSM providers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/osmextract/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Add new OpenStreetMap providers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/osmextract/blob/HEAD/vignettes/providers.Rmd" class="external-link"><code>vignettes/providers.Rmd</code></a></small>
      <div class="hidden name"><code>providers.Rmd</code></div>

    </div>

    
    
<p>This vignette aims to provide a simple guide on adding a new provider
to <code>osmextract</code>. Let’ start loading the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmextract/" class="external-link">osmextract</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright.</span></span>
<span><span class="co">#&gt; Check the package website, https://docs.ropensci.org/osmextract/, for more details.</span></span></code></pre></div>
<p>As of summer 2020, there are several services providing bulk OSM
datasets listed <a href="https://wiki.openstreetmap.org/wiki/Processed_data_providers" class="external-link">here</a>
and <a href="https://wiki.openstreetmap.org/wiki/Planet.osm#Country_and_area_extracts" class="external-link">here</a>.
At the moment, we support the following providers:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/oe_providers.html">oe_providers</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Check the corresponding help pages to read more details about the fields in each database (e.g. ?geofabrik_zones)</span></span>
<span><span class="co">#&gt;   available_providers          database_name number_of_zones number_of_fields</span></span>
<span><span class="co">#&gt; 1           geofabrik        geofabrik_zones             430               14</span></span>
<span><span class="co">#&gt; 2              bbbike           bbbike_zones             235               10</span></span>
<span><span class="co">#&gt; 3    openstreetmap_fr openstreetmap_fr_zones             903                6</span></span></code></pre></div>
<p>Check the “Comparing the supported OSM providers” for more details on
the existing providers.</p>
<p>This package is designed to make it easy to add new providers. There
are three main steps to add a new provider: creating the zones, adding
the provider and documenting it. They are outlined below.</p>
<div class="section level2">
<h2 id="adding-a-provider_zones-object-to-the-package">Adding a <code>provider_zones</code> object to the package<a class="anchor" aria-label="anchor" href="#adding-a-provider_zones-object-to-the-package"></a>
</h2>
<p>The first and hardest step is to create an <code>sf</code> object
analogous to the <code>test_zones</code> object shown below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">test_zones</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id"            "name"          "parent"        "level"        </span></span>
<span><span class="co">#&gt; [5] "pbf_file_size" "pbf"           "geometry"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">test_zones</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'sf' and 'data.frame':   2 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;  $ name    : chr  "Isle of Wight" "ITS Leeds"</span></span>
<span><span class="co">#&gt;  $ pbf     : chr  "https://github.com/ropensci/osmextract/releases/download/0.0.1/geofabrik_isle-of-wight-latest.osm.pbf" "https://github.com/ropensci/osmextract/raw/master/inst/its-example.osm.pbf"</span></span>
<span><span class="co">#&gt;  $ geometry:sfc_POLYGON of length 2; first list element: List of 1</span></span>
<span><span class="co">#&gt;   ..$ : num [1:7, 1:2] -1.52 -1.66 -1.31 -1.11 -1.03 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"</span></span>
<span><span class="co">#&gt;  - attr(*, "sf_column")= chr "geometry"</span></span>
<span><span class="co">#&gt;  - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:2] "name" "pbf"</span></span></code></pre></div>
<p>The output shows the three most important column names:</p>
<ol style="list-style-type: decimal">
<li>The zone <code>name</code> (that is used for matching the input
<code>place</code>, see <code><a href="../reference/oe_match.html">oe_match()</a></code>);</li>
<li>The URL endpoint where <code>.pbf</code> files associated with each
zone can be downloaded;</li>
<li>The geometry, representing the spatial extent of the dataset.</li>
</ol>
<p>The object must also include the fields <code>level</code> and
<code>id</code>, which are used, respectively, for spatial matching and
updating. See <code><a href="../reference/oe_match.html">oe_match()</a></code> and <code><a href="../reference/oe_update.html">oe_update()</a></code>.</p>
<p>The best way to start creating a new <code>_zones</code> object for a
new provider is probably by looking at the code we wrote for the first
supported provider in <a href="https://github.com/ropensci/osmextract/blob/master/data-raw/geofabrik_zones.R" class="external-link"><code>data-raw/geofabrik_zones.R</code></a>.
The following commands will clone this repo and open the relevant
file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone git@github.com:ropensci/osmextract</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">rstudio</span> osmextract/osmextract.Rproj</span></code></pre></div>
<p>Then in RStudio:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/file.edit.html" class="external-link">file.edit</a></span><span class="op">(</span><span class="st">"data-raw/geofabrik_zones.R"</span><span class="op">)</span></span></code></pre></div>
<p>Create a new script to document the code that generates the new
object, e.g. for <code>bbbike</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/file.edit.html" class="external-link">file.edit</a></span><span class="op">(</span><span class="st">"data-raw/bbbike_zones.R"</span><span class="op">)</span></span>
<span><span class="co"># or, even better, use</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_data_raw</span><span class="op">(</span><span class="st">"bbbike_zones"</span><span class="op">)</span></span></code></pre></div>
<p>After you have created the new provider <code>_zones</code> file,
it’s time to add the provider to the package.</p>
</div>
<div class="section level2">
<h2 id="adding-the-new-provider-to-the-package">Adding the new provider to the package<a class="anchor" aria-label="anchor" href="#adding-the-new-provider-to-the-package"></a>
</h2>
<p>Once you have created your overview <code>_zones</code> file as
outlined in the previous step, you need to modify the following files
for the provider to be available for others:</p>
<ul>
<li>
<a href="https://github.com/ropensci/osmextract/blob/master/R/data.R" class="external-link">data.R</a>,
where you’ll need to document the new dataset;</li>
<li>
<a href="https://github.com/ropensci/osmextract/blob/master/R/globals.R" class="external-link">globals.R</a>,
where you’ll need to add the new object name;</li>
<li>
<a href="https://github.com/ropensci/osmextract/blob/master/R/providers.R" class="external-link">providers.R</a>,
where you’ll need to add the new object name in
<code>oe_available_providers()</code> and
<code>load_provider_data()</code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="documenting-the-provider">Documenting the provider<a class="anchor" aria-label="anchor" href="#documenting-the-provider"></a>
</h2>
<p>The final step is also the most fun: documenting and using the
provider. Add an example, mention it in the README and tell others about
what this new provider can do! If you want to ask for help on adding a
new provider, feel free to open in a new issue in the <a href="https://github.com/ropensci/osmextract" class="external-link">github repository</a>!</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette talks through the main steps needed to extend
<code>osmextract</code> by adding new OSM data providers. To see the
same information in code form, see the PR that implemented the
<code>openstreetmap_fr</code> provider here: <a href="https://github.com/ropensci/osmextract/commit/dbf131667a80e5a6837a6c8eb3b967075e1aba16" class="external-link uri">https://github.com/ropensci/osmextract/commit/dbf131667a80e5a6837a6c8eb3b967075e1aba16</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
